<?php
include('config/boot.php');

$res = $db->query("
	SELECT *
	FROM PERSONS_TBL 
	ORDER BY ID
	");
$persons = array();
while($p = $res->fetch_object()) {
	$persons[] = $p;
}
?>
<!DOCTYPE html>
<html>
<head>
	<title>Telbook</title>
	
	<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
	
	<link rel="stylesheet" type="text/css" href="css/default.css">

	<script type="text/javascript" src="js/jquery-2.1.3.js"></script>
	<script type="text/javascript" src="js/application.js"></script>
</head>
<body>
	<table class='layout'>
		<tr>
			<td class='panel'>
			<h1>Persons</h1>
			<table class='grid'>
				<tr>
					<th>ID</th>
					<th>NAME</th>
					<th>FAM</th>
					<th>ADDRESS</th>
					<th>Suljo</th>
					<th>Puljo</th>
					<th></th>
				<tr>
				<?php
					foreach($persons as $p) {
						echo "<tr>
							<td>".$p->ID."</td>
							<td>".$p->NAME."</td>
							<td>".$p->FAM."</td>
							<td>".$p->ADDRESS."</td>
							<td>
								<a href='get-tels-json.php?id=".$p->ID."' class='icon view_icon person-show-tels'>Show Tels</a>
							</td>
							<td>
								<a href='person-edit.php?id=$p->ID' class='icon edit_icon person-edit'>Edit</a>
							</td>
							<td>
								<a href='person-delete.php?id=$p->ID' class='icon delete_icon person-delete'>Delete</a>
							</td>
						</tr>";
					}
				?>
			</table>
			<p>
				<a href='person-edit.php' class='icon add_icon person-edit'>Add new person</a>
				<a href='./' class='icon refresh_icon'>Refresh</a>
			</p>
			</td>
			<td class='panel'>
				<div id='person-details'>
				</div>
			</td>
		</tr>
		<tr>
			<td class='panel'>
				<h1>Telephones</h1>
				<div id='tels-list'>
					<p class='icon info_icon'>Select a person to view his telephones.</p>
				</div>
			</td>
			<td class='panel'>
				<div id='tel-details'>
				</div>
			</td>
		</tr>
	</table>
</body>
</html>